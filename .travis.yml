language: php

sudo: false

cache:
    directories:
        - $HOME/.composer/cache/files

php:
    - 7.4

env:
    - SUITE="curl" PACKAGE="php-http/curl-client:dev-master zendframework/zend-diactoros"
    - SUITE="Socket" PACKAGE="php-http/socket-client:dev-master php-http/client-common"
    - SUITE="Guzzle6" PACKAGE="php-http/guzzle6-adapter:dev-master"
    - SUITE="Guzzle" PACKAGE="guzzlehttp/guzzle:dev-master"
    - SUITE="Guzzle" PACKAGE="guzzlehttp/guzzle:dev-master phpunit/phpunit:^8.5.8"
    - SUITE="Buzz" PACKAGE="kriswallsmith/buzz:dev-master"

matrix:
    include:
        - php: 5.5
          env: SUITE="Guzzle5" PACKAGE="php-http/guzzle5-adapter:dev-master"

branches:
    except:
        - /^analysis-.*$/

before_install:
    - phpenv config-rm xdebug.ini || true

install:
    - composer require ${PACKAGE} --no-update
    - travis_retry composer update --prefer-source --no-interaction

before_script:
    - bin/http_test_server > /dev/null 2>&1 &

script:
    - ./vendor/bin/phpunit --testsuite ${SUITE}

